SUMMARY="Open-source clone of the original X-Com"
DESCRIPTION="OpenXcom is an open-source clone of the original UFO: Enemy \
Unknown (X-Com: UFO Defense in USA), licensed under the GPL and written in \
C++ / SDL. It was originally founded by SupSuper in February 2010, and has \
since grown into a small development team surrounded by a very supporting \
community.

The game requires the original XCOM or TFTD datafiles.
Copy them to: `finddir B_USER_NONPACKAGED_DATA_DIRECTORY`/openxcom/UFO or \
`finddir B_USER_NONPACKAGED_DATA_DIRECTORY`/openxcom/TFTD"
HOMEPAGE="https://openxcom.org/"
COPYRIGHT="2010-2018 OpenXcom Developers"
LICENSE="GNU GPL v3"
REVISION="1"
srcGitRev="57a10ae13866f80894463b3f92dd9a2fb110c562"
SOURCE_URI="https://github.com/SupSuper/OpenXcom/archive/$srcGitRev.tar.gz"
CHECKSUM_SHA256="8697c6d647c8890f293554722e3476ab6e4fe79e21a21961289ba76df3513f44"
SOURCE_DIR="OpenXcom-$srcGitRev"
PATCHES="openxcom-$portVersion.patchset"
ADDITIONAL_FILES="openxcom.rdef"

ARCHITECTURES="!x86_gcc2 ?x86_64 x86"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	openxcom$secondaryArchSuffix = $portVersion
	app:OpenXcom
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libexecinfo$secondaryArchSuffix
	lib:libgl$secondaryArchSuffix
	lib:libglu$secondaryArchSuffix
	lib:libsdl$secondaryArchSuffix
	lib:libsdl_gfx$secondaryArchSuffix
	lib:libsdl_image$secondaryArchSuffix
	lib:libsdl_mixer$secondaryArchSuffix
	lib:libyaml_cpp$secondaryArchSuffix >= 0.5
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libexecinfo$secondaryArchSuffix
	devel:libgl$secondaryArchSuffix
	devel:libglu$secondaryArchSuffix
	devel:libsdl$secondaryArchSuffix
	devel:libsdl_gfx$secondaryArchSuffix
	devel:libsdl_image$secondaryArchSuffix
	devel:libsdl_mixer$secondaryArchSuffix
	devel:libyaml_cpp$secondaryArchSuffix >= 0.5
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

GLOBAL_WRITABLE_FILES="
	settings/OpenXcom directory keep-old
	"

defineDebugInfoPackage openxcom$secondaryArchSuffix \
	"$appsDir"/OpenXcom

BUILD()
{
	export LDFLAGS="-lexecinfo"
	cmake . \
		$cmakeDirArgs

	make $jobArgs
}

INSTALL()
{
	make install

	# binary got installed in $binDir
	# but as it got GUI, let's move it to $appsDir
	mkdir -p $appsDir
	mv $binDir/openxcom $appsDir/OpenXcom

	# and delete the useless $binDir, and stuff
	rm -rf $binDir
	rm -rf $dataDir/{applications,icons}

	# create a settings dir
	mkdir -p $settingsDir/OpenXcom

	# let's add the icons
	addResourcesToBinaries \
		$portDir/additional-files/openxcom.rdef $appsDir/OpenXcom

	# and let's create an icon in the Deskbar
	addAppDeskbarSymlink $appsDir/OpenXcom OpenXcom
}
